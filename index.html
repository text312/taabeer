<!DOCTYPE html>
<html lang="ar" dir="rtl">
<!--
  Express My Feelings / تعبير عن مشاعري
  Beautiful, dual-language, emotional message sharing platform
  Enhanced with: gradient animations, 3D effects, micro-interactions, and elegant UI
-->

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تعبير عن مشاعري</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #ff4d78;
      --primary-light: #ff85a2;
      --primary-dark: #d93d65;
      --secondary: #7f5af0;
      --accent: #25d0ab;
      --text: #2e2e3a;
      --text-light: #5a5a6e;
      --bg: #fff8fa;
      --card-bg: rgba(255, 255, 255, 0.85);
      --card-shadow: 0 10px 30px rgba(255, 112, 150, 0.12);
      --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
    }
    .dark {
      --primary: #ff85a2;
      --primary-light: #ffb3c6;
      --primary-dark: #ff7096;
      --secondary: #9370ff;
      --accent: #2ce0b9;
      --text: #f0f0f5;
      --text-light: #c2c2d6;
      --bg: #1a1a24;
      --card-bg: rgba(30, 30, 40, 0.9);
      --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    
    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Tajawal', 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow-x: hidden;
      transition: var(--transition);
      line-height: 1.6;
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 70% 30%, rgba(255, 112, 150, 0.08) 0%, transparent 50%),
                  radial-gradient(circle at 30% 70%, rgba(127, 90, 240, 0.08) 0%, transparent 50%);
      animation: gradientRotate 30s linear infinite;
      z-index: -2;
    }
    @keyframes gradientRotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Floating Elements Animation */
    .floating-elements {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }
    .floating-element {
      position: absolute;
      opacity: 0.6;
      animation: float 15s linear infinite;
      will-change: transform;
      filter: blur(0.5px);
    }
    @keyframes float {
      0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 0; }
      10% { opacity: 0.6; }
      90% { opacity: 0.6; }
      100% { transform: translateY(-100vh) rotate(360deg) scale(1.2); opacity: 0; }
    }
    
    /* Main Container */
    .container {
      position: relative;
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 24px;
      box-shadow: var(--card-shadow);
      padding: 2.5rem 2rem;
      width: 95%;
      max-width: 480px;
      text-align: center;
      transform-style: preserve-3d;
      perspective: 1000px;
      animation: fadeInUp 1s cubic-bezier(0.23, 1, 0.32, 1) both;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }
    .container::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      pointer-events: none;
      animation: shine 6s infinite;
    }
    @keyframes shine {
      0% { transform: translateX(-100%) rotate(45deg); }
      100% { transform: translateX(100%) rotate(45deg); }
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Header */
    h1 {
      font-size: 2.2rem;
      color: var(--primary);
      margin-bottom: 1.5rem;
      font-weight: 700;
      position: relative;
      display: inline-block;
    }
    h1::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 3px;
    }
    
    /* Toggle Buttons */
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    .toggle-btn {
      background: rgba(127, 90, 240, 0.1);
      border: none;
      border-radius: 50px;
      padding: 0.5rem 1rem;
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--secondary);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .toggle-btn:hover {
      background: rgba(127, 90, 240, 0.2);
      transform: translateY(-2px);
    }
    .toggle-btn:active {
      transform: translateY(0);
    }
    
    /* Textarea */
    textarea {
      width: 100%;
      padding: 1.2rem;
      border-radius: 16px;
      border: 2px solid rgba(255, 112, 150, 0.3);
      font-size: 1.1rem;
      resize: vertical;
      min-height: 150px;
      background: rgba(255, 255, 255, 0.7);
      color: var(--text);
      margin-bottom: 1.2rem;
      transition: var(--transition);
      font-family: inherit;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    .dark textarea {
      background: rgba(30, 30, 40, 0.7);
      border-color: rgba(255, 112, 150, 0.2);
    }
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 112, 150, 0.2);
      background: rgba(255, 255, 255, 0.9);
    }
    .dark textarea:focus {
      background: rgba(40, 40, 50, 0.9);
    }
    
    /* Emoji Picker */
    .emoji-picker {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 16px;
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.05);
    }
    .dark .emoji-picker {
      background: rgba(30, 30, 40, 0.5);
    }
    .emoji-btn {
      background: none;
      border: none;
      font-size: 1.6rem;
      cursor: pointer;
      transition: var(--transition);
      padding: 0.3rem;
      border-radius: 10px;
      line-height: 1;
    }
    .emoji-btn:hover {
      transform: scale(1.3) translateY(-3px);
      background: rgba(255, 112, 150, 0.2);
    }
    
    /* Submit Button */
    .submit-btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 50px;
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 4px 15px rgba(255, 112, 150, 0.3);
      position: relative;
      overflow: hidden;
      margin-top: 0.5rem;
      width: 100%;
      max-width: 220px;
    }
    .submit-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 112, 150, 0.4);
    }
    .submit-btn:active {
      transform: translateY(0);
    }
    .submit-btn::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: rotate(45deg);
      pointer-events: none;
      animation: shine 4s infinite;
    }
    .submit-btn[disabled] {
      background: var(--text-light);
      box-shadow: none;
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    /* Loading Animation */
    .loading-dots {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      margin-left: 0.5rem;
    }
    .loading-dots span {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: currentColor;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }
    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }
    
    /* Admin Button */
    .admin-btn {
      background: rgba(37, 208, 171, 0.1);
      color: var(--accent);
      border: none;
      border-radius: 50px;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 1.5rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .admin-btn:hover {
      background: rgba(37, 208, 171, 0.2);
      transform: translateY(-2px);
    }
    
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }
    .modal {
      background: var(--card-bg);
      border-radius: 24px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      padding: 2rem;
      width: 90%;
      max-width: 400px;
      transform: translateY(20px);
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .modal-overlay.active .modal {
      transform: translateY(0);
    }
    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-light);
      cursor: pointer;
      transition: var(--transition);
    }
    .modal-close:hover {
      color: var(--primary);
      transform: rotate(90deg);
    }
    .modal-input-wrapper {
      position: relative;
      width: 100%;
    }
    #toggle-password {
      position: absolute;
      left: 0.7rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.2rem;
      color: #888;
      outline: none;
      padding: 0;
      z-index: 2;
    }
    #toggle-password:active {
      color: var(--primary);
    }
    .modal-title {
      color: var(--primary);
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      text-align: center;
    }
    .modal-input {
      width: 100%;
      padding: 1rem;
      border-radius: 12px;
      border: 2px solid rgba(255, 112, 150, 0.3);
      background: rgba(255, 255, 255, 0.7);
      color: var(--text);
      margin-bottom: 1.5rem;
      transition: var(--transition);
      font-family: inherit;
    }
    .dark .modal-input {
      background: rgba(30, 30, 40, 0.7);
    }
    .modal-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 112, 150, 0.2);
    }
    .modal-error {
      color: #ff4d4d;
      margin-top: 0.5rem;
      min-height: 1.2em;
      text-align: center;
    }
    
    /* Admin Panel */
    .admin-panel {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 200;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
      overflow-y: auto;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .admin-panel.active {
      opacity: 1;
      pointer-events: all;
    }
    .admin-container {
      background: var(--card-bg);
      border-radius: 24px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      padding: 2rem;
      width: 100%;
      max-width: 600px;
      margin: auto;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    .admin-title {
      color: var(--primary);
      font-size: 1.5rem;
    }
    .logout-btn {
      background: rgba(255, 112, 150, 0.1);
      color: var(--primary);
      border: none;
      border-radius: 50px;
      padding: 0.5rem 1rem;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .logout-btn:hover {
      background: rgba(255, 112, 150, 0.2);
      transform: translateY(-2px);
    }
    .messages-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .message-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.05);
      animation: fadeIn 0.5s ease both;
      transition: var(--transition);
      position: relative;
    }
    .dark .message-card {
      background: rgba(40, 40, 50, 0.5);
    }
    .message-card.unread {
      border-left: 4px solid var(--primary);
    }
    .message-content {
      font-size: 1.1rem;
      white-space: pre-line;
      word-break: break-word;
      margin-bottom: 1rem;
      line-height: 1.7;
    }
    .message-date {
      font-size: 0.85rem;
      color: var(--text-light);
      margin-bottom: 0.5rem;
    }
    .message-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      margin-top: 1rem;
    }
    .msg-status-badge {
      display: inline-block;
      font-size: 0.85rem;
      font-weight: 600;
      border-radius: 12px;
      padding: 0.2rem 0.7rem;
      margin-right: 0.6rem;
      margin-left: 0.2rem;
      vertical-align: middle;
    }
    .read-badge {
      background: rgba(37, 208, 171, 0.15);
      color: var(--accent);
      border: 1px solid var(--accent);
    }
    .unread-badge {
      background: rgba(255, 77, 79, 0.13);
      color: #ff4d4f;
      border: 1px solid #ff4d4f;
    }
    .message-btn {
      padding: 0.4rem 1.1rem;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      border: none;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      outline: none;
    }
    .read-btn {
      background: rgba(37, 208, 171, 0.12);
      color: var(--accent);
    }
    .read-btn:hover {
      background: rgba(37, 208, 171, 0.22);
      color: var(--accent);
      transform: translateY(-2px);
    }
    .delete-btn {
      background: rgba(255, 77, 79, 0.10);
      color: #ff4d4f;
    }
    .delete-btn:hover {
      background: rgba(255, 77, 79, 0.18);
      color: #ff4d4f;
      transform: translateY(-2px);
    }
    .message-btn {
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      border: none;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .read-btn {
      background: rgba(37, 208, 171, 0.1);
      color: var(--accent);
    }
    .read-btn:hover {
      background: rgba(37, 208, 171, 0.2);
    }
    .delete-btn {
      background: rgba(255, 77, 79, 0.1);
      color: #ff4d4f;
    }
    .delete-btn:hover {
      background: rgba(255, 77, 79, 0.2);
    }
    .dark .message-card {
      background: rgba(40, 40, 50, 0.5);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .message-content {
      font-size: 1.1rem;
      white-space: pre-line;
      word-break: break-word;
      margin-bottom: 1rem;
      line-height: 1.7;
    }
    .message-date {
      font-size: 0.85rem;
      color: var(--text-light);
      text-align: right;
    }
    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--text-light);
      font-size: 1.1rem;
    }
    .loading-state {
      display: flex;
      justify-content: center;
      padding: 2rem;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 600px) {
      .container {
        padding: 1.8rem 1.5rem;
        border-radius: 20px;
      }
      h1 {
        font-size: 1.8rem;
      }
      textarea {
        font-size: 1rem;
        padding: 1rem;
      }
      .submit-btn {
        padding: 0.9rem 2rem;
        font-size: 1rem;
      }
      .admin-container {
        padding: 1.5rem;
      }
    }
    @media (max-width: 400px) {
      .container {
        padding: 1.5rem 1.2rem;
      }
      h1 {
        font-size: 1.6rem;
      }
      .toggle-btn, .admin-btn, .logout-btn {
        font-size: 0.85rem;
        padding: 0.4rem 0.8rem;
      }
    }
    /* Hide all scrollbars but allow scrolling */
    html, body, * {
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
    }
    html::-webkit-scrollbar, body::-webkit-scrollbar, *::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }
  </style>
</head>
<body>
  <!-- Floating Elements Background -->
  <div class="floating-elements" id="floating-elements"></div>
  
  <!-- Main App Container -->
  <div class="container" id="app">
    <div class="toggle-row">
      <button class="toggle-btn" id="lang-toggle" onclick="toggleLang()">
        <span id="lang-icon">🌐</span>
        <span id="lang-text">English</span>
      </button>
      <button class="toggle-btn" id="mode-toggle" onclick="toggleMode()">
        <span id="mode-icon">🌙</span>
        <span id="mode-text">الوضع المظلم</span>
      </button>
    </div>
    
    <h1 id="title">تعبير عن مشاعرك</h1>
    
    <div class="emoji-picker" id="emoji-picker"></div>
    
    <textarea id="message" rows="6" placeholder="اكتبي ما تشعرين به هنا..." maxlength="800"></textarea>
    
    <button class="submit-btn" id="submit-btn" onclick="sendMessage()">
      <span id="submit-text">إرسال</span>
    </button>
    
    <button class="admin-btn" onclick="showLoginModal()">
      <span id="admin-icon">🔐</span>
      <span id="admin-text">دخول المشرف</span>
    </button>
  </div>
  
  <!-- Admin Login Modal -->
  <div class="modal-overlay" id="login-modal">
    <div class="modal">
      <button class="modal-close" onclick="hideLoginModal()">✕</button>
      <h2 class="modal-title" id="login-title">دخول المشرف</h2>
      <div class="modal-input-wrapper" style="position:relative;">
        <input type="password" class="modal-input" id="admin-password" placeholder="كلمة المرور" style="padding-left:2.5rem;">
        <button type="button" id="toggle-password" style="position:absolute;left:0.7rem;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;font-size:1.2rem;color:#888;" tabindex="-1" aria-label="Show/Hide Password">👁️</button>
      </div>
      <div class="modal-error" id="login-error"></div>
      <button class="submit-btn" id="login-btn" onclick="adminLogin()">
        <span id="login-text">دخول</span>
      </button>
    </div>
  </div>
  
  <!-- Admin Panel -->
  <div class="admin-panel" id="admin-panel">
    <div class="admin-container">
      <div class="admin-header">
        <button class="modal-close" id="admin-panel-close" style="margin-left:0.5rem;" onclick="hideAdminPanel()">✕</button>
        <h2 class="admin-title" id="msgs-title">الرسائل المستلمة</h2>
        <button class="logout-btn" onclick="logoutAdmin()">
          <span id="logout-icon">🚪</span>
          <span id="logout-text">خروج</span>
        </button>
      </div>
      
      <div class="messages-list" id="msgs-list"></div>
      
      <div class="loading-state" id="msgs-loading" style="display: none;">
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      
      <div class="empty-state" id="msgs-empty" style="display: none;">
        <span id="no-msgs-text">لا توجد رسائل بعد</span>
      </div>
      
      <div class="modal-error" id="msgs-error"></div>
    </div>
  </div>

  <script>
    // --- Configuration ---
    let isArabic = localStorage.getItem('isArabic') !== 'false';
    let isDark = localStorage.getItem('isDark') === 'true';
    let isAdmin = false;
    let adminPassword = '';
    const API_BASE = 'https://taabeer.onrender.com';
    const emojis = ['😊','😢','❤️','🥰','😔','🌸','🌹','✨','🙏','😇','😞','😃','😭','😌','💖','😶','🤍','😅','😳','🥺','😡','😱','😴','😎','🤗','😍','😕','💔','💗','🤍','🌷'];
    const shapes = [
      '<svg width="32" height="32" viewBox="0 0 32 32"><path fill="#ffb3c6" d="M16 29s-13-8.35-13-17A7 7 0 0 1 16 7a7 7 0 0 1 13 5c0 8.65-13 17-13 17Z"/></svg>',
      '<svg width="32" height="32" viewBox="0 0 32 32"><path d="M16 29C16 29 3 20.65 3 12A7 7 0 0 1 16 5a7 7 0 0 1 13 7c0 8.65-13 17-13 17Z" fill="#ffd3e0"/></svg>',
      '<svg width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="#ffd3e0"/></svg>',
      '<svg width="32" height="32" viewBox="0 0 32 32"><ellipse cx="16" cy="16" rx="10" ry="14" fill="#ff7096"/></svg>'
    ];
    
    // --- Initialize App ---
    function initApp() {
      // Set initial theme
      if (isDark) {
        document.body.classList.add('dark');
        document.getElementById('mode-icon').textContent = '☀️';
        document.getElementById('mode-text').textContent = isArabic ? 'الوضع المضيء' : 'Light Mode';
      }
      // Set initial language
      updateLanguage();
      // Render emoji picker
      renderEmojis();
      // Create floating elements
      createFloatingElements();
      // Set up textarea auto-resize
      setupTextarea();
      // Setup password visibility toggle
      const pwInput = document.getElementById('admin-password');
      const toggleBtn = document.getElementById('toggle-password');
      if (pwInput && toggleBtn) {
        toggleBtn.onclick = function(e) {
          e.preventDefault();
          if (pwInput.type === 'password') {
            pwInput.type = 'text';
            toggleBtn.textContent = '🙈';
          } else {
            pwInput.type = 'password';
            toggleBtn.textContent = '👁️';
          }
        };
      }
    }
    // Hide admin panel without logging out
    function hideAdminPanel() {
      document.getElementById('admin-panel').classList.remove('active');
    }
    
    // --- Floating Elements Background ---
    function createFloatingElements() {
      const container = document.getElementById('floating-elements');
      const count = Math.floor(window.innerWidth / 20);
      
      for (let i = 0; i < count; i++) {
        const element = document.createElement('div');
        element.className = 'floating-element';
        
        // Random properties
        const size = 20 + Math.random() * 30;
        const left = Math.random() * 100;
        const delay = Math.random() * 15;
        const duration = 10 + Math.random() * 20;
        
        // Set styles
        element.style.width = `${size}px`;
        element.style.height = `${size}px`;
        element.style.left = `${left}%`;
        element.style.top = `${100 + Math.random() * 20}%`;
        element.style.animationDelay = `${delay}s`;
        element.style.animationDuration = `${duration}s`;
        element.style.opacity = 0.3 + Math.random() * 0.5;
        
        // Random shape
        element.innerHTML = shapes[Math.floor(Math.random() * shapes.length)];
        
        container.appendChild(element);
      }
    }
    
    // --- Textarea Setup ---
    function setupTextarea() {
      const textarea = document.getElementById('message');
      
      // Auto-resize
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
      
      // Focus effect
      textarea.addEventListener('focus', function() {
        this.parentElement.querySelector('.submit-btn').style.transform = 'translateY(0)';
      });
    }
    
    // --- Language Toggle ---
    function toggleLang() {
      isArabic = !isArabic;
      localStorage.setItem('isArabic', isArabic);
      updateLanguage();
    }
    
    function updateLanguage() {
      // Update HTML attributes
      document.documentElement.lang = isArabic ? 'ar' : 'en';
      document.documentElement.dir = isArabic ? 'rtl' : 'ltr';
      
      // Update UI texts
      document.getElementById('title').textContent = isArabic ? 'تعبير عن مشاعرك' : 'Express Your Feelings';
      document.getElementById('message').placeholder = isArabic ? 'اكتبي ما تشعرين به هنا...' : 'Write how you feel here...';
      document.getElementById('lang-text').textContent = isArabic ? 'English' : 'العربية';
      document.getElementById('submit-text').textContent = isArabic ? 'إرسال' : 'Send';
      document.getElementById('admin-text').textContent = isArabic ? 'دخول المشرف' : 'Admin Login';
      document.getElementById('login-title').textContent = isArabic ? 'دخول المشرف' : 'Admin Login';
      document.getElementById('admin-password').placeholder = isArabic ? 'كلمة المرور' : 'Password';
      document.getElementById('login-text').textContent = isArabic ? 'دخول' : 'Login';
      document.getElementById('msgs-title').textContent = isArabic ? 'الرسائل المستلمة' : 'Received Messages';
      document.getElementById('logout-text').textContent = isArabic ? 'خروج' : 'Logout';
      document.getElementById('no-msgs-text').textContent = isArabic ? 'لا توجد رسائل بعد' : 'No messages yet';
      document.getElementById('mode-text').textContent = isDark ? 
        (isArabic ? 'الوضع المضيء' : 'Light Mode') : 
        (isArabic ? 'الوضع المظلم' : 'Dark Mode');
      
      // Update emoji picker direction
      document.getElementById('emoji-picker').style.flexDirection = isArabic ? 'row-reverse' : 'row';
      
      // Clear errors
      document.getElementById('login-error').textContent = '';
      document.getElementById('msgs-error').textContent = '';
      
      // Rerender messages if admin panel is open
      if (isAdmin && document.getElementById('admin-panel').classList.contains('active')) {
        fetchMessages();
      }
    }
    
    // --- Dark/Light Mode Toggle ---
    function toggleMode() {
      isDark = !isDark;
      localStorage.setItem('isDark', isDark);
      document.body.classList.toggle('dark', isDark);
      
      // Update mode toggle button
      const modeIcon = document.getElementById('mode-icon');
      const modeText = document.getElementById('mode-text');
      if (isDark) {
        modeIcon.textContent = '☀️';
        modeText.textContent = isArabic ? 'الوضع المضيء' : 'Light Mode';
      } else {
        modeIcon.textContent = '🌙';
        modeText.textContent = isArabic ? 'الوضع المظلم' : 'Dark Mode';
      }
      
      // Rerender messages if admin panel is open
      if (isAdmin && document.getElementById('admin-panel').classList.contains('active')) {
        fetchMessages();
      }
    }
    
    // --- Emoji Picker ---
    function renderEmojis() {
      const picker = document.getElementById('emoji-picker');
      picker.innerHTML = '';
      
      emojis.forEach(emoji => {
        const btn = document.createElement('button');
        btn.className = 'emoji-btn';
        btn.textContent = emoji;
        btn.onclick = () => {
          const textarea = document.getElementById('message');
          const start = textarea.selectionStart;
          const end = textarea.selectionEnd;
          
          textarea.value = textarea.value.substring(0, start) + emoji + textarea.value.substring(end);
          textarea.focus();
          textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
          
          // Trigger input event for auto-resize
          const event = new Event('input', { bubbles: true });
          textarea.dispatchEvent(event);
        };
        
        picker.appendChild(btn);
      });
      
      picker.style.flexDirection = isArabic ? 'row-reverse' : 'row';
    }
    
    // --- Message Submission ---
    async function sendMessage() {
      const message = document.getElementById('message').value.trim();
      if (!message) {
        showTemporaryAlert(isArabic ? 'الرسالة فارغة!' : 'Message is empty!');
        return;
      }
      
      const btn = document.getElementById('submit-btn');
      const originalText = btn.innerHTML;
      
      // Show loading state
      btn.disabled = true;
      btn.innerHTML = `<span>${isArabic ? 'جاري الإرسال' : 'Sending'}</span>
                      <span class="loading-dots"><span></span><span></span><span></span></span>`;
      
      try {
        const response = await fetch(`${API_BASE}/api/message`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content: message })
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          // Success
          showTemporaryAlert(isArabic ? 'تم إرسال الرسالة بنجاح ❤' : 'Message sent successfully ❤');
          document.getElementById('message').value = '';
          
          // Reset textarea height
          const textarea = document.getElementById('message');
          textarea.style.height = 'auto';
        } else {
          // Error
          showTemporaryAlert(data?.error || (isArabic ? 'حدث خطأ أثناء الإرسال' : 'Failed to send message'));
        }
      } catch (error) {
        // Network error
        showTemporaryAlert(isArabic ? 'تعذر الاتصال بالخادم' : 'Failed to connect to server');
      } finally {
        // Reset button
        btn.disabled = false;
        btn.innerHTML = originalText;
      }
    }
    
    // --- Temporary Alert ---
    function showTemporaryAlert(message) {
      const alert = document.createElement('div');
      alert.textContent = message;
      alert.style.position = 'fixed';
      alert.style.bottom = '20px';
      alert.style.left = '50%';
      alert.style.transform = 'translateX(-50%)';
      alert.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
      alert.style.color = 'white';
      alert.style.padding = '12px 24px';
      alert.style.borderRadius = '50px';
      alert.style.zIndex = '1000';
      alert.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
      alert.style.animation = 'fadeInUp 0.3s ease-out';
      
      document.body.appendChild(alert);
      
      setTimeout(() => {
        alert.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => alert.remove(), 300);
      }, 3000);
    }
    
    // --- Admin Login Modal ---
    function showLoginModal() {
  // If password is in localStorage, don't open the modal
  if (localStorage.getItem('adminPassword')) {
    return;
  }
  document.getElementById('login-modal').classList.add('active');
  document.getElementById('admin-password').value = '';
  document.getElementById('login-error').textContent = '';
  setTimeout(() => document.getElementById('admin-password').focus(), 100);
}

    function hideLoginModal() {
      document.getElementById('login-modal').classList.remove('active');
    }
    
    async function adminLogin() {
      const password = document.getElementById('admin-password').value.trim();
      if (!password) {
        hideLoginModal();
        return;
      }
      
      const btn = document.getElementById('login-btn');
      const originalText = btn.innerHTML;
      
      // Show loading state
      btn.disabled = true;
      btn.innerHTML = `<span>${isArabic ? 'جاري الدخول' : 'Logging in'}</span>
                      <span class="loading-dots"><span></span><span></span><span></span></span>`;
      
      try {
        const response = await fetch(`${API_BASE}/api/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          // Success
          isAdmin = true;
          adminPassword = password;
          localStorage.setItem('adminPassword', password);
          hideLoginModal();
          showAdminPanel();
        } else {
          // Error
          document.getElementById('login-error').textContent = 
            data?.error || (isArabic ? 'كلمة المرور غير صحيحة' : 'Incorrect password');
        }
      } catch (error) {
        // Network error
        document.getElementById('login-error').textContent = 
          isArabic ? 'تعذر الاتصال بالخادم' : 'Failed to connect to server';
      } finally {
        // Reset button
        btn.disabled = false;
        btn.innerHTML = originalText;
      }
    }
    
    // --- Admin Panel ---
    function showAdminPanel() {
      document.getElementById('admin-panel').classList.add('active');
      document.getElementById('msgs-list').innerHTML = '';
      document.getElementById('msgs-error').textContent = '';
      document.getElementById('msgs-empty').style.display = 'none';
      document.getElementById('msgs-loading').style.display = 'flex';
      
      fetchMessages();
    }
    
    function logoutAdmin() {
      isAdmin = false;
      adminPassword = '';
      localStorage.removeItem('adminPassword');
      document.getElementById('admin-panel').classList.remove('active');
    }
    
    async function fetchMessages() {
      try {
        const response = await fetch(`${API_BASE}/api/messages`, {
          headers: { password: adminPassword }
        });
        
        const data = await response.json();
        
        if (response.ok && Array.isArray(data)) {
          renderMessages(data);
        } else {
          document.getElementById('msgs-error').textContent = 
            data?.error || (isArabic ? 'تعذر جلب الرسائل' : 'Failed to fetch messages');
          document.getElementById('msgs-empty').style.display = 'none';
        }
      } catch (err) {
        document.getElementById('msgs-error').textContent =
          isArabic ? 'تعذر جلب الرسائل' : 'Failed to fetch messages';
        document.getElementById('msgs-empty').style.display = 'none';
        console.error(err);
      }
    }
    
    // --- Helper Functions ---
    function escapeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML.replace(/\n/g, '<br>');
    }

    function formatDate(isoString) {
      if (!isoString) return '';
      const date = new Date(isoString);
      return date.toLocaleString('en-GB', { dateStyle: 'medium', timeStyle: 'short' });
    }
    
    function renderMessages(messages) {
      const list = document.getElementById('msgs-list');
      messages.forEach(message => {
        const card = document.createElement('div');
        card.className = 'message-card';
        card.innerHTML = `
          <div class="message-header">
            <span class="msg-status-badge ${message.read ? 'read-badge' : 'unread-badge'}">
              ${message.read ? (isArabic ? '✓ تمت القراءة' : '✓ Read') : (isArabic ? 'غير مقروء' : 'Unread')}
            </span>
            <span>${formatDate(message.createdAt)}</span>
          </div>
          <div class="message-content">
            ${escapeHTML(message.content)}
          </div>
          <div class="message-actions">
            <button class="message-btn read-btn mark-read-btn">${isArabic ? 'تم القراءة' : 'Mark Read'}</button>
            <button class="message-btn delete-btn delete-msg-btn">${isArabic ? 'حذف' : 'Delete'}</button>
          </div>
        `;
        
        if (message.read) {
          card.classList.add('read');
        } else {
          card.classList.add('unread');
        }
        
        const markReadBtn = card.querySelector('.mark-read-btn');
        markReadBtn.onclick = () => markAsRead(message._id, markReadBtn);
        
        const deleteBtn = card.querySelector('.delete-msg-btn');
        deleteBtn.onclick = () => deleteMessage(message._id, deleteBtn);
        
        list.appendChild(card);
      });
      
      if (messages.length === 0) {
        document.getElementById('msgs-empty').style.display = 'block';
      }
    }
    
    // --- Helper Functions ---
    function escapeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML.replace(/\n/g, '<br>');
    }
    
    // --- Mark Message as Read ---
    async function markAsRead(messageId, button) {
      try {
        button.disabled = true;
        button.innerHTML = `<span class="loading-dots"><span></span><span></span><span></span></span>`;
        
        const response = await fetch(`${API_BASE}/api/messages/${messageId}/read`, {
          method: 'PATCH',
          headers: { 
            'Content-Type': 'application/json',
            password: adminPassword
          }
        });
        const data = await response.json();
        
        if (response.ok && data.success) {
          // Update UI
          const card = button.closest('.message-card');
          card.classList.remove('unread');
          button.textContent = isArabic ? 'تمت القراءة' : 'Read';
          button.style.opacity = '0.7';
          button.disabled = true;
        } else {
          showTemporaryAlert(data?.error || (isArabic ? 'فشل تحديث الحالة' : 'Failed to update status'));
          button.disabled = false;
          button.textContent = isArabic ? 'تم القراءة' : 'Mark Read';
        }
      } catch (error) {
        showTemporaryAlert(isArabic ? 'خطأ في الاتصال' : 'Connection error');
        button.disabled = false;
        button.textContent = isArabic ? 'تم القراءة' : 'Mark Read';
      }
    }
    
    // --- Delete Message ---
    async function deleteMessage(messageId, button) {
      if (!confirm(isArabic ? 'هل أنت متأكد من حذف هذه الرسالة؟' : 'Are you sure you want to delete this message?')) {
        return;
      }
      try {
        button.disabled = true;
        button.innerHTML = `<span class="loading-dots"><span></span><span></span><span></span></span>`;
        
        const response = await fetch(`${API_BASE}/api/messages/${messageId}`, {
          method: 'DELETE',
          headers: { 
            'Content-Type': 'application/json',
            password: adminPassword
          }
        });
        const data = await response.json();
        
        if (response.ok && data.success) {
          // Remove from UI
          const card = button.closest('.message-card');
          card.style.animation = 'fadeOut 0.3s ease-out';
          setTimeout(() => card.remove(), 300);
          showTemporaryAlert(isArabic ? 'تم الحذف بنجاح' : 'Message deleted');
        } else {
          showTemporaryAlert(data?.error || (isArabic ? 'فشل الحذف' : 'Delete failed'));
          button.disabled = false;
          button.textContent = isArabic ? 'حذف' : 'Delete';
        }
      } catch (error) {
        showTemporaryAlert(isArabic ? 'خطأ في الاتصال' : 'Connection error');
        button.disabled = false;
        button.textContent = isArabic ? 'حذف' : 'Delete';
      }
    }
    
    // --- Initialize on Load ---
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>